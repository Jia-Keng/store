import{d as Q,r as c,E as X,B as C,o as Y,z as Z,A as ee,c as f,f as s,C as te,D as y,F as A,n as j,e as le,m as h}from"./index-nySzXKt_.js";const ne={class:"absolute inset-0 flex items-center justify-center"},se={key:0,class:"absolute inset-0 z-0 flex items-center justify-center text-white"},oe={class:"w-full h-[5rem] absolute top-0 left-0 z-10"},ie={class:"w-[25rem] h-[3rem] px-[18px] absolute top-[2.3rem] left-1/2 -translate-x-1/2 bg-[#6A6A6A] flex justify-center items-center",style:{"clip-path":"polygon(0% 0%, 10.5% 100%, 89.5% 100%, 100% 0%)","-webkit-clip-path":"polygon(0% 0%, 10.5% 100%, 89.5% 100%, 100% 0%)"}},re={class:"w-full h-[5rem] absolute bottom-0 left-0 z-10"},ae="http://localhost:8000",H=2,k=10,E=6,ue=Q({__name:"MonitorScreen",setup(ce){const O=c(null),w=c(null);let g=null;const M=[{id:1,url:"rtsp://10.253.254.11:554/profile1"},{id:2,url:"rtsp://10.253.254.12:554/profile1"},{id:3,url:"rtsp://10.253.254.13:554/profile1"},{id:4,url:"rtsp://10.253.254.14:554/profile1"}],R=new Map,b=new Map,d=new Set,o=new Map,x=c(!0),u=c(0),p=c(0),i=c(1),v=X({}),G=C(()=>!u.value||!p.value?{}:{width:`${u.value*i.value}px`,height:`${p.value*i.value}px`}),B=()=>{o.clear(),Object.keys(v).forEach(t=>{delete v[Number(t)]}),u.value=0,p.value=0,i.value=1},S=()=>{const t=new Set;o.forEach((e,l)=>{t.add(l),v[l]={width:`${e.width*i.value}px`,height:`${e.height*i.value}px`}}),Object.keys(v).forEach(e=>{const l=Number(e);t.has(l)||delete v[l]})},m=()=>{const t=w.value;if(!t||!u.value||!p.value){i.value=1,S();return}const e=t.getBoundingClientRect(),l=e.width?e.width/u.value:1,n=e.height?e.height/p.value:1;i.value=Math.min(1,l,n),S()},W=()=>{if(o.size===0){u.value=0,p.value=0,i.value=1,S();return}const t=Math.max(...Array.from(o.values(),a=>a.width)),e=Math.max(...Array.from(o.values(),a=>a.height)),l=Math.max(o.size,1),n=Math.min(H,l),r=Math.max(1,Math.ceil(l/H));u.value=t*n,p.value=e*r,m()},$=(t,e)=>{const l=t.videoWidth,n=t.videoHeight;if(!l||!n)return;const r=o.get(e);if(r&&r.width===l&&r.height===n){S();return}o.set(e,{width:l,height:n}),W()},K=()=>{d.clear(),M.forEach(t=>d.add(t.id)),x.value=d.size>0,B()},z=t=>{d.has(t)&&(d.delete(t),d.size===0&&(x.value=!1))},T=(t,e)=>{if(t instanceof HTMLVideoElement){R.set(e,t);return}t||(R.delete(e),o.delete(e),delete v[e],W())},I=()=>{const t=window.WebRtcStreamer;if(!t){console.error("WebRtcStreamer script is not available. Ensure it is loaded before mounting this view.");return}K(),M.forEach(e=>{const l=b.get(e.id);l&&l.disconnect();const n=R.get(e.id);if(!n){z(e.id);return}const r=()=>{$(n,e.id),m()},a=()=>{D(),$(n,e.id),z(e.id)},U=J=>{console.error(`Failed to load stream ${e.id}`,J),D(),z(e.id)},D=()=>{n.removeEventListener("loadedmetadata",r),n.removeEventListener("loadeddata",a),n.removeEventListener("playing",a),n.removeEventListener("error",U)};n.addEventListener("loadedmetadata",r),n.addEventListener("loadeddata",a),n.addEventListener("playing",a),n.addEventListener("error",U);const F=new t(n,ae);F.connect(e.url),b.set(e.id,F)}),m()},N=()=>{b.forEach(t=>{t.disconnect()}),b.clear(),d.clear(),x.value=!0,B()},V=()=>{N()},L=c(null),P=C(()=>{if(L.value){const t=L.value.getBoundingClientRect(),e=Math.floor(t.width/(k+E));return Math.max(1,Number.isFinite(e)?e:1)}return 1}),_=c(null),q=C(()=>{if(_.value){const t=_.value.getBoundingClientRect(),e=Math.floor(t.width/(k+E));return Math.max(1,Number.isFinite(e)?e:1)}return 1});return Y(async()=>{await Z(),I(),window.addEventListener("beforeunload",V),window.addEventListener("resize",m),w.value&&typeof ResizeObserver<"u"&&(g=new ResizeObserver(()=>m()),g.observe(w.value))}),ee(()=>{window.removeEventListener("beforeunload",V),window.removeEventListener("resize",m),g&&(g.disconnect(),g=null),N()}),(t,e)=>(h(),f(A,null,[s("div",ne,[s("div",{ref_key:"videoWrapperRef",ref:w,class:"relative flex items-center justify-center w-[80%] h-[75%]"},[x.value?(h(),f("p",se,[...e[0]||(e[0]=[s("svg",{class:"mr-3 -ml-1 size-5 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),s("span",null,"請稍後，正在載入",-1)])])):te("",!0),s("div",{ref_key:"videosRef",ref:O,style:y(G.value),class:"relative z-10 inline-grid grid-cols-[repeat(2,auto)] grid-rows-[repeat(2,auto)] gap-0"},[(h(),f(A,null,j(M,l=>s("video",{key:l.id,ref_for:!0,ref:n=>T(n,l.id),style:y(v[l.id]),class:"block",autoplay:"",muted:"",playsinline:""},null,4)),64))],4)],512)]),s("div",oe,[e[3]||(e[3]=s("div",{class:"w-full h-[2.5rem] top-0 left-0 bg-[#6A6A6A] flex items-center justify-center"},[s("p",{class:"text-white"},"Kaohsiung Medical University")],-1)),s("div",ie,[e[1]||(e[1]=s("div",{class:"w-[26px] h-[2.1rem] bg-[#000000]/25",style:{"clip-path":"polygon(0% 0%, 100% 0%, 100% 100%)","-webkit-clip-path":"polygon(0% 0%, 100% 0%, 100% 100%)"}},null,-1)),s("div",{ref_key:"topStyleRef",ref:L,class:"flex-1 h-full flex justify-center items-center",style:y(`gap: ${E}px`)},[(h(!0),f(A,null,j(P.value,l=>(h(),f("div",{key:l,class:"h-[2.1rem] bg-[#000000]/25",style:y(`width: ${k}px`)},null,4))),128))],4),e[2]||(e[2]=s("div",{class:"w-[26px] h-[2.1rem] bg-[#000000]/25",style:{"clip-path":"polygon(0% 0%, 0% 100%, 100% 0%)","-webkit-clip-path":"polygon(0% 0%, 0% 100%, 100% 0%)"}},null,-1))])]),s("div",re,[s("div",{ref_key:"bottomStyleRef",ref:_,class:"w-full h-[3rem] pb-1 absolute bottom-0 left-0 bg-[#6A6A6A] flex flex-row items-center",style:y(`gap: ${E}px`)},[(h(!0),f(A,null,j(q.value,l=>(h(),f("div",{key:l,class:"h-[2.1rem] bg-[#000000]/25",style:y(`width: ${k}px`)},null,4))),128))],4),e[4]||(e[4]=le('<div class="w-[25rem] h-full absolute bottom-0 left-1/2 -translate-x-1/2 bg-[#6A6A6A] flex justify-center items-center" style="clip-path:polygon(10.5% 0%, 0% 100%, 100% 100%, 89.5% 0%);-webkit-clip-path:polygon(10.5% 0%, 0% 100%, 100% 100%, 89.5% 0%);"><div class="w-[calc(25rem-32px)] h-[calc(100%-16px)] bg-[#303030]/60 flex justify-center items-center" style="clip-path:polygon(8% 0%, 0% 100%, 100% 100%, 92% 0%);-webkit-clip-path:polygon(8% 0%, 0% 100%, 100% 100%, 92% 0%);"><p class="text-white text-xl">監視器畫面</p></div></div><div class="w-[10rem] h-full absolute left-0 bg-[#6A6A6A]" style="clip-path:polygon(0% 0%, 0% 100%, 100% 100%, 70% 0%);-webkit-clip-path:polygon(0% 0%, 0% 100%, 100% 100%, 70% 0%);"></div><div class="w-[10rem] h-full absolute right-0 bg-[#6A6A6A]" style="clip-path:polygon(30% 0%, 0% 100%, 100% 100%, 100% 0%);-webkit-clip-path:polygon(30% 0%, 0% 100%, 100% 100%, 100% 0%);"></div>',3))])],64))}});export{ue as default};
