import{g as ue}from"./api-C8S97F_S.js";import{d as ee,c,m as i,F as R,f as l,t as r,i as p,y as x,s as S,r as u,o as de,z as he,A as fe,B as ve,C as pe,D as T,n as Z,x as xe,q as me,p as G,j as $}from"./index-nySzXKt_.js";import{c as H}from"./createLucideIcon-CGH2yFtG.js";const ge=H("droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]);const ye=H("thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);const K=H("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),we="/assets/ServerRoomBG-Dh5bvdzP.png",be={class:"mx-2"},_e={class:"w-full px-2 py-1 flex flex-row items-center bg-[#303030]/60"},ke={class:"w-fit px-2 font-bold border-b-2 border-white"},Ce={class:"py-1 flex flex-row items-center justify-center border-t-2 border-white"},$e={key:0,class:"flex flex-row gap-2 bg-[#303030]/60 border-4 border-[#0067AC] rounded-lg"},Se={class:"flex-1 p-2 flex flex-col"},Ae={class:"self-start flex flex-row items-center gap-1"},je={class:"self-center my-2 text-3xl font-bold"},ze={class:"self-end"},Le={class:"flex-1 p-2 flex flex-col"},Me={class:"self-end flex flex-row-reverse items-center gap-1"},Be={class:"self-center my-2 text-3xl font-bold"},Te={class:"self-end"},Re={key:1,class:"flex flex-row gap-2 bg-[#303030]/60 border-4 border-[#0067AC] rounded-lg"},He={class:"flex-1 p-2 flex flex-col"},De={class:"self-start flex flex-row items-center gap-1"},Ee={class:"self-center my-2 text-3xl font-bold"},Ne={class:"self-end"},Ue={class:"flex-1 p-2 flex flex-col"},Pe={class:"self-end flex flex-row-reverse items-center gap-1"},Ve={class:"self-center my-2 text-3xl font-bold"},Ie={class:"self-end"},J=ee({__name:"ValueCard",props:{title:{},value1:{},value2:{},ups:{type:Boolean}},setup(o){return(A,d)=>(i(),c(R,null,[l("div",be,[l("div",_e,[l("p",ke,r(o.title),1),d[0]||(d[0]=l("div",{class:"w-[1rem] h-full"},[l("div",{class:"w-[2px] h-[2rem] bg-white origin-bottom-left rotate-[36deg] -translate-x-[2px] -translate-y-[4px]"})],-1)),l("div",Ce,[(i(),p(x(o.value1.icon),{class:S(["w-4 h-4",o.ups?"fill-white":""])},null,8,["class"])),(i(),p(x(o.value2.icon),{class:S(["w-4 h-4",o.ups?"hidden":""])},null,8,["class"]))])])]),o.ups?(i(),c("div",$e,[l("div",Se,[l("div",Ae,[(i(),p(x(o.value1.icon),{class:"w-5 h-5 mb-1 fill-white"})),l("p",null,r(o.value1.title),1)]),l("p",je,r(o.value1.value),1),l("p",ze,r(o.value1.unit),1)]),d[1]||(d[1]=l("div",{class:"self-stretch w-[4px] bg-[#0067AC]"},null,-1)),l("div",Le,[l("div",Me,[(i(),p(x(o.value2.icon),{class:"w-5 h-5 mb-1"})),l("p",null,r(o.value2.title),1)]),l("p",Be,r(o.value2.value),1),l("p",Te,r(o.value2.unit),1)])])):(i(),c("div",Re,[l("div",He,[l("div",De,[(i(),p(x(o.value1.icon),{class:"w-5 h-5 mb-1"})),l("p",null,r(o.value1.title),1)]),l("p",Ee,r(o.value1.value),1),l("p",Ne,r(o.value1.unit),1)]),d[2]||(d[2]=l("div",{class:"self-stretch w-[4px] bg-[#0067AC]"},null,-1)),l("div",Ue,[l("div",Pe,[(i(),p(x(o.value2.icon),{class:"w-5 h-5 mb-1"})),l("p",null,r(o.value2.title),1)]),l("p",Ve,r(o.value2.value),1),l("p",Ie,r(o.value2.unit),1)])]))],64))}}),We={class:"absolute w-full h-screen flex items-center justify-center z-[-1]"},Xe=["viewBox"],qe=["x1","y1","x2","y2"],Fe=["cx","cy"],Oe=["cx","cy"],Ye=["x1","y1","x2","y2"],Ze=["x","y","width","height"],Ge=["cx","cy","r"],Ke={key:0},Je={class:"mx-2"},Qe={class:"w-full px-2 py-1 flex flex-row items-center bg-[#303030]/60"},et={class:"w-fit px-2 font-bold border-b-2 border-white"},tt={class:"w-fit px-2 font-bold border-t-2 border-white"},lt={class:"p-2 grid grid-cols-2 bg-[#303030]/60 border-4 border-[#0067AC] rounded-lg *:text-center"},st={key:1},ot={key:2},Q=10,ct=ee({__name:"TemperatureHumidity",setup(o){const A=u(null),d=u(null),te=u({width:0,height:0}),a=u({left:0,top:0,width:0,height:0}),h=u(null),f=u(null),j=u(new Map),D=u([]),E=u(!1);function le(e){return e?e instanceof HTMLElement?e:e.$el??null:null}function se(e,s){const n=le(s),t=e;if(n){j.value.set(t,n);return}j.value.delete(t)}function N(e){return e&&typeof e=="object"&&"temp"in e&&"hum"in e?e:null}function U(e){return e&&typeof e=="object"&&"voltage"in e&&"current"in e?e:null}function P(e){return typeof e=="boolean"?e:null}function z(e,s,n){return Number.isNaN(e)?s:Math.min(Math.max(e,s),n)}const oe={device1:{start:"left",end:"bottom",vertical:1},device2:{start:"right",end:"bottom",vertical:1},UPS:{start:"right",end:"bottom",vertical:1},doorSwitch:{start:"right",end:"left",vertical:1,horizontal:-1}};function ie(e,s){return s.type==="circle"?{x:e.x,y:e.y+s.radius}:{x:e.x,y:e.y+s.height/2}}function ae(e,s,n){if(s.type==="circle"){const w=Math.max(s.radius-Q,4),b=z(n-e.y,-w,w),_=Math.sqrt(Math.max(s.radius**2-b**2,0));return{x:e.x-_,y:e.y+b}}const t=s.height/2,v=Math.max(t-Q/2,4),y=z(n-e.y,-v,v);return{x:e.x-s.width/2,y:e.y+y}}function m(){if(h.value){const e=h.value.getBoundingClientRect();te.value={width:e.width,height:e.height}}V()}function V(){if(f.value&&h.value){const e=h.value.getBoundingClientRect(),s=f.value.getBoundingClientRect();a.value={left:s.left-e.left,top:s.top-e.top,width:s.width,height:s.height}}}function g(){if(!h.value||!f.value||a.value.width===0)return;const e=[];F.forEach(s=>{const n=j.value.get(s.key);if(!n)return;const t=oe[s.key],v=s.cardLocation[0]/100*a.value.width,y=s.cardLocation[1]/100*a.value.height,w=n.offsetWidth/2,b=n.offsetHeight/2,_=v-w,O=y-b,Y=2/3;let L=v,M=y;t.start==="left"?(L=_,M=O+n.offsetHeight*Y):t.start==="right"&&(L=_+n.offsetWidth,M=O+n.offsetHeight*Y);const k={x:L,y:M},B={x:s.point[0]/100*a.value.width,y:s.point[1]/100*a.value.height};let C;t.end==="bottom"?C=ie(B,s.targetShape):C=ae(B,s.targetShape,k.y);const ce={x:z((k.x+C.x)/2,0,a.value.width),y:k.y};e.push({id:s.id,start:k,joint:ce,end:C,target:B,targetShape:s.targetShape})}),D.value=e,E.value=e.length>0}function ne(e,s){let n;return((...t)=>{clearTimeout(n),n=setTimeout(()=>e.apply(null,t),s)})}const I=ne(()=>{m(),V(),g()},100);function W(){I()}async function X(){try{const e=await ue();A.value=e,d.value=new Date}catch(e){e instanceof Error?(console.log("資料獲取錯誤"),console.log(e.message)):console.error(e)}}const q={homepage:null,dialog:null,startHomepage(){this.stopHomepage(),this.homepage=setInterval(async()=>{await X()},60*1e3)},stopHomepage(){this.homepage&&(clearInterval(this.homepage),this.homepage=null)},stopAll(){this.stopHomepage()}};de(async()=>{await X(),await he(),setTimeout(()=>{m(),g()},100),q.startHomepage(),f.value&&(f.value.complete?(m(),g()):f.value.addEventListener("load",()=>{m(),g()},{once:!0})),window.addEventListener("resize",W);const e=new MutationObserver(()=>{I()});return h.value&&e.observe(h.value,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]}),()=>{window.removeEventListener("resize",W),e.disconnect()}}),fe(()=>{q.stopAll()});const F=[{id:1,key:"device1",name:"溫溼度計偵測器#1",point:[19.8,18.5],cardLocation:[38,25],dataType:"sensor",targetShape:{type:"circle",radius:30}},{id:2,key:"device2",name:"溫溼度計偵測器#2",point:[76.9,11.5],cardLocation:[62,21],dataType:"sensor",targetShape:{type:"circle",radius:30}},{id:3,key:"UPS",name:"UPS#1當前使用情況",point:[64,71],cardLocation:[50,85],dataType:"ups",targetShape:{type:"rect",width:80,height:80}},{id:4,key:"doorSwitch",name:["當前狀況","門禁狀況"],point:[29.5,58.5],cardLocation:[15,45],dataType:"door",targetShape:{type:"circle",radius:30}}],re=ve(()=>F.map(e=>({...e,section:A.value?.[e.key]})));return(e,s)=>{const n=xe("card");return i(),c("div",{class:"w-full h-full xl:min-h-screen relative overflow-hidden",ref_key:"containerRef",ref:h},[l("div",We,[l("img",{ref_key:"bgModelRef",ref:f,src:we,class:"max-w-full max-h-full object-contain"},null,512)]),E.value?(i(),c("svg",{key:0,class:"absolute z-15 pointer-events-none",style:T(`left: ${a.value.left}px; top: ${a.value.top}px; width: ${a.value.width}px; height: ${a.value.height}px;`),viewBox:`0 0 ${a.value.width} ${a.value.height}`},[(i(!0),c(R,null,Z(D.value,t=>(i(),c("g",{key:t.id},[l("line",{x1:t.start.x,y1:t.start.y,x2:t.joint.x,y2:t.joint.y,stroke:"#0067AC","stroke-width":"4",opacity:"0.8"},null,8,qe),l("circle",{cx:t.joint.x,cy:t.joint.y,r:"6",fill:"transparent",stroke:"#0067AC","stroke-width":"2"},null,8,Fe),l("circle",{cx:t.joint.x,cy:t.joint.y,r:"4",fill:"#0067AC"},null,8,Oe),l("line",{x1:t.joint.x,y1:t.joint.y,x2:t.end.x,y2:t.end.y,stroke:"#0067AC","stroke-width":"4",opacity:"0.8"},null,8,Ye),t.targetShape.type==="rect"?(i(),c("rect",{key:0,x:t.target.x-t.targetShape.width/2,y:t.target.y-t.targetShape.height/2,width:t.targetShape.width,height:t.targetShape.height,fill:"#0067AC4D",stroke:"#0067AC","stroke-width":"4"},null,8,Ze)):(i(),c("circle",{key:1,cx:t.target.x,cy:t.target.y,r:t.targetShape.radius,fill:"#0067AC4D",stroke:"#0067AC","stroke-width":"4"},null,8,Ge))]))),128))],12,Xe)):pe("",!0),l("div",{class:"absolute z-30",style:T(`left: ${a.value.left}px; top: ${a.value.top}px; width: ${a.value.width}px; height: ${a.value.height}px;`)},[(i(!0),c(R,null,Z(re.value,t=>(i(),p(n,{key:t.id,ref_for:!0,ref:v=>se(t.key,v),class:"absolute w-[18rem] max-w-[20%] cursor-pointer group",style:T({top:`${t.cardLocation[1]/100*a.value.height}px`,left:`${t.cardLocation[0]/100*a.value.width}px`,transform:"translate(-50%, -50%)"})},{default:me(()=>[t.dataType==="door"?(i(),c("div",Ke,[l("div",Je,[l("div",Qe,[l("p",et,r(t.name[0]),1),s[0]||(s[0]=l("div",{class:"w-[1rem] h-full"},[l("div",{class:"w-[2px] h-[2rem] bg-white origin-bottom-left rotate-[36deg] -translate-x-[2px] -translate-y-[4px]"})],-1)),l("p",tt,r(t.name[1]),1)])]),l("div",lt,[l("div",{class:S(["m-2 border rounded-full",P(t.section)?"bg-[#67cc69]":"inset-shadow-md"])},"房門開啟",2),l("div",{class:S(["m-2 border rounded-full",P(t.section)?"inset-shadow-md":"bg-[#67cc69]"])},"房門關閉",2)])])):t.dataType==="ups"?(i(),c("div",st,[G(J,{title:t.name,value1:{icon:$(K),title:"電壓",value:U(t.section)?.voltage??null,unit:"V"},value2:{icon:$(K),title:"電流",value:U(t.section)?.current??null,unit:"A"},ups:!0},null,8,["title","value1","value2"])])):(i(),c("div",ot,[G(J,{title:t.name,value1:{icon:$(ye),title:"溫度",value:N(t.section)?.temp??null,unit:"°C"},value2:{icon:$(ge),title:"濕度",value:N(t.section)?.hum??null,unit:"%"},ups:!1},null,8,["title","value1","value2"])]))]),_:2},1032,["style"]))),128))],4)],512)}}});export{ct as default};
